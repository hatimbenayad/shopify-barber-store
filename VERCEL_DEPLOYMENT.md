# Vercel Deployment Guide for Shopify Barber App

## Overview
Your Shopify Barber App is now configured for deployment on Vercel with the credentials you provided from Shopify Partners Dashboard.

## Your Shopify App Credentials
- **Client ID**: `4211c9c0ad918242e2f09285acbb554e`
- **Client Secret**: `989fb4f3e9753dbc8da6607b7308dbf9`

## Quick Deployment Steps

### 1. Database Setup (Required First)

Since Vercel is serverless, you need a cloud database. Choose one:

#### Option A: Vercel Postgres (Recommended)
```bash
# Install Vercel CLI
npm i -g vercel

# Login to Vercel
vercel login

# Create Vercel Postgres database
vercel storage create postgres --name shopify-barber-db
```

#### Option B: Neon (Free PostgreSQL)
1. Go to [neon.tech](https://neon.tech)
2. Create free account and database
3. Copy connection string

#### Option C: Supabase
1. Go to [supabase.com](https://supabase.com)
2. Create new project
3. Copy PostgreSQL connection string

### 2. Deploy to Vercel

#### Method 1: Vercel CLI (Recommended)
```bash
# Clone your project
cd shopify-barber-app

# Install dependencies
npm install

# Deploy to Vercel (this will prompt you to set up the project)
vercel

# After initial deployment, set environment variables
vercel env add SHOPIFY_API_KEY
# Enter: 4211c9c0ad918242e2f09285acbb554e

vercel env add SHOPIFY_API_SECRET
# Enter: 989fb4f3e9753dbc8da6607b7308dbf9

vercel env add DATABASE_URL
# Enter: your PostgreSQL connection string

vercel env add SESSION_SECRET
# Enter: a long random string (e.g., generated by openssl rand -base64 32)

vercel env add SCOPES
# Enter: read_products,write_products,read_customers,write_customers,read_orders,write_orders,read_draft_orders,write_draft_orders,read_inventory,write_inventory

vercel env add SHOPIFY_APP_URL
# Enter: https://your-app-name.vercel.app

# Deploy to production
vercel --prod
```

#### Method 2: Vercel Dashboard (Alternative)
1. Go to [vercel.com](https://vercel.com)
2. Import your Git repository
3. Go to Project Settings â†’ Environment Variables
4. Add these variables for **Production**, **Preview**, and **Development**:

| Variable Name | Value |
|---------------|-------|
| `SHOPIFY_API_KEY` | `4211c9c0ad918242e2f09285acbb554e` |
| `SHOPIFY_API_SECRET` | `989fb4f3e9753dbc8da6607b7308dbf9` |
| `DATABASE_URL` | Your PostgreSQL connection string |
| `SESSION_SECRET` | Generate a random string (32+ characters) |
| `SCOPES` | `read_products,write_products,read_customers,write_customers,read_orders,write_orders,read_draft_orders,write_draft_orders,read_inventory,write_inventory` |
| `SHOPIFY_APP_URL` | `https://your-app-name.vercel.app` |
| `NODE_ENV` | `production` |

5. Click **Deploy** to trigger a new deployment with the environment variables.

### 3. Configure Shopify Partners Dashboard

Once deployed, update your Shopify app settings:

1. Go to [partners.shopify.com](https://partners.shopify.com)
2. Select your app
3. Update URLs:
   - **App URL**: `https://your-app-name.vercel.app/`
   - **Allowed redirection URLs**: `https://your-app-name.vercel.app/auth/callback`
4. Configure App Proxy:
   - **Subpath prefix**: `apps`
   - **Subpath**: `barber`
   - **URL**: `https://your-app-name.vercel.app/app_proxy`

### 4. Test Your App

1. **Create Development Store**:
   - In Partners Dashboard â†’ Development stores
   - Create new store for testing
   - Install your app on the test store

2. **Test Features**:
   - Admin functionality (barbers, services, appointments)
   - Storefront booking widget
   - App proxy functionality

## Environment Variables Reference

```env
# Your actual Shopify credentials
SHOPIFY_API_KEY=4211c9c0ad918242e2f09285acbb554e
SHOPIFY_API_SECRET=989fb4f3e9753dbc8da6607b7308dbf9

# Scopes your app needs
SCOPES=read_products,write_products,read_customers,write_customers,read_orders,write_orders,read_draft_orders,write_draft_orders,read_inventory,write_inventory

# Your Vercel app URL
SHOPIFY_APP_URL=https://your-app-name.vercel.app

# Database connection (from your chosen provider)
DATABASE_URL=postgresql://username:password@hostname:5432/database

# Generate a strong random string for sessions
SESSION_SECRET=your_super_secret_random_string_here

# Production mode
NODE_ENV=production
```

## Database Migration

After deploying, run database migrations:

```bash
# Using Vercel CLI
vercel env pull .env.local
npx prisma migrate deploy
npx prisma generate
```

Or set up GitHub Actions for automatic migrations (see below).

## Continuous Deployment (Optional)

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to Vercel
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npx prisma generate
      - uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
```

## Troubleshooting

### Common Issues

1. **Environment Variable Reference Errors**
   ```
   Error: Environment Variable "SHOPIFY_API_KEY" references Secret "shopify_api_key", which does not exist.
   ```
   **Solution**: Set environment variables directly in Vercel Dashboard or using `vercel env add` command. Don't use the `@` prefix for secrets unless you've specifically created Vercel secrets.

2. **Database Connection Errors**
   - Ensure `DATABASE_URL` is correctly formatted
   - Check if database allows connections from Vercel IPs
   - Verify database credentials

2. **Shopify Authentication Issues**
   - Double-check API credentials match Partners Dashboard
   - Ensure `SHOPIFY_APP_URL` matches your Vercel domain
   - Verify redirect URLs are configured correctly

3. **Build Failures**
   - Check that all environment variables are set
   - Ensure Prisma can generate client during build
   - Verify Node.js version compatibility

### Performance Optimization

1. **Connection Pooling**: Use connection pooling for database
2. **Caching**: Implement caching for frequently accessed data
3. **Bundle Size**: Monitor and optimize bundle size

## Next Steps

1. **Test on Development Store**: Install and test all features
2. **Production Testing**: Thoroughly test all functionality
3. **App Store Submission**: When ready, submit to Shopify App Store
4. **Monitoring**: Set up error tracking and monitoring

## Support

- Vercel Documentation: [vercel.com/docs](https://vercel.com/docs)
- Shopify App Development: [shopify.dev](https://shopify.dev)
- Prisma with Vercel: [prisma.io/docs/guides/deployment/deploying-to-vercel](https://prisma.io/docs/guides/deployment/deploying-to-vercel)

---

Your app is now ready for Vercel deployment! ðŸš€